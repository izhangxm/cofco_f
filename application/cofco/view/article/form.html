{include file="cofco@block/edit_form"/}
<script>
    var status = parseInt({:artFiledValue($art_arr, 'status')});
    for (var i = 1; i < 5; i++) {
        if (i < parseInt(status) - 1 || i > parseInt(status) + 1) {
            input = $('.field-status[value="' + i + '"]');
            input.prop('disabled', true);
        }
    }

    $(function () {
        disableField(['special_version']);
    });


    $ = layui.jquery;
    var label_arr = new Array();
    $(function(){
        var data = {:htmlspecialchars_decode($menu_list)};
        var label = {:htmlspecialchars_decode(json_encode($label))};

        for(var a in label){
            label_arr.push(label[a]['label_id']);
        }
        tnTreeBox('treebox','checkboxname',data,label_arr);
    });

    $('#formSubmit').click(function (e) {
        console.log(label_arr);
        var form_s = $('#editForm');
        var form_data = form_s.serializeArray();
        form_data.push({
            name: "pre_status",
            value: status
        });
        var label_ids = new Array();  // 标签id
        $(".header div.tag").each(function() {
            // let this = $(this);
            console.log($(this).attr('value'));
            label_ids.push($(this).attr('value'));
        });
        form_data.push({
            name: "label_ids",
            value: label_ids
        });
        console.log(form_data);
        var article_api_url_edit = "{:url($article_api_url.'/edit')}";
        console.log(article_api_url_edit);
        $.post(article_api_url_edit, form_data, function (res) {
            console.log(res);
            if (res.code === 0) {
                console.log(res.message);
                layer.msg(
                    res.message
                    , {time: 1000}
                    , function () {
                        var index = parent.layer.getFrameIndex(window.name);
                        parent.layer.close(index);//关闭当前页
                        parent.layui.table.reload('articletable'); //刷新表格
                    });

            } else {
                layer.msg(res.message);
            }
        });
        if (e.preventDefault) {
            e.preventDefault();
        } else {
            window.event.returnValue == false;
        }
    });
</script>
<script type="text/javascript">

</script>