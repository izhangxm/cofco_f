{include file="cofco@block/edit_form"/}
<div class="layui-row">
    <div class="layui-col-md10">
        <button type="button" class="layui-btn layui-btn-sm" lay-submit="" style="width: 200px;"
                id="formSubmit">标注完成
        </button>
    </div>
</div>
<style>
    #edit-div{
        padding: 10px 20px;
    }
</style>
<script>
    disableField(['special_version']);

    layui.use(['jquery', 'layer', 'laydate'], function () {
        var layer = layui.layer;
        var $ = layui.jquery;
        var status = parseInt({:artFiledValue($art_arr, 'status')});
        $('input[name="status"][value!="2"]').attr('disabled', true).addClass('disabled');

        var data = {:htmlspecialchars_decode($label_list)};
        var label = {:htmlspecialchars_decode(json_encode($label))};
        var label_arr = new Array();
        for(var a in label){
            label_arr.push(label[a]['label_id']);
        }
        tnTreeBox('treebox',data,label_arr);



        //表单提交
        // $('#formSubmit').click(function (e) {
        //     var form_s = $('#editForm');
        //     var form_data = form_s.serializeArray();
        //     form_data.push({
        //         name: "pre_status",
        //         value: status
        //     });
        //     var label_ids = new Array();  // 标签id
        //     $(".header div.tag").each(function() {
        //         label_ids.push(parseInt($(this).attr('value')));
        //     });
        //     console.log(label_ids);
        //
        //     let a = label_ids;
        //     let b =label_arr;
        //
        //     let label_add = a.filter(v => !b.includes(v)); // [1,3,4,5]
        //     // console.log("增加");
        //     // console.log(label_add);
        //
        //     let label_del = b.filter(v => !a.includes(v)); // [1,3,4,5]
        //     // console.log("删除");
        //     // console.log(label_del);
        //
        //     form_data.push({
        //         name: "label_add",
        //         value: label_add
        //     });
        //
        //     form_data.push({
        //         name: "label_del",
        //         value: label_del
        //     });
        //
        //     console.log(form_data);
        //
        //     var article_api_url_edit = "{:url($article_api_url.'/edit')}";
        //     // console.log(article_api_url_edit);
        //     $.post(article_api_url_edit, form_data, function (res) {
        //         console.log(res);
        //         if (res.code === 1) {
        //             console.log(res.msg);
        //             layer.alert(
        //                 res.msg
        //                 , {offset:'130px'}
        //                 , function (e) {
        //                     var index = parent.layer.getFrameIndex(window.name);
        //                     parent.layer.close(index);//关闭当前页
        //                     parent.layui.table.reload('articletable'); //刷新表格
        //                 });
        //         } else {
        //             layer.msg(res.msg, {offset:'130px'});
        //         }
        //     });
        // });
        formSubmit(status,label_arr);
    });
</script>
